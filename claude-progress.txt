=== Tap In V1 - Development Progress ===

## Session 1 - 2026-02-07

### Completed Features:
- Feature #1: Database connection established ✅
- Feature #2: Database schema applied correctly ✅
- Feature #3: Data persists across server restart ✅

### What was built:
- Backend Express server (Node.js) at port 3001
- SQLite database using sql.js with file-based persistence (backend/data/tapin.db)
- Full database schema with 9 tables matching app_spec.txt:
  - organizations, users, categories, transactions, payment_requests
  - payment_events, attachments, notifications, transaction_audit_log
- All tables have proper foreign keys, NOT NULL constraints, CHECK constraints, and DEFAULT values
- Health endpoint (GET /api/health) with database status
- Auth routes (POST /api/auth/login, GET /api/auth/me, POST /api/auth/refresh)
- Transactions CRUD routes (GET, POST, PUT, DELETE /api/transactions)
- JWT authentication middleware
- Debug schema endpoint (GET /api/debug/schema) for verification
- Default seed data: 1 organization, 10 categories (5 ingreso + 5 egreso), 3 test users
- init.sh startup script

### Test Users:
- presidente@tapin.cl / password123 (Presidente)
- secretaria@tapin.cl / password123 (Secretaria)
- delegado@tapin.cl / password123 (Delegado)

### Technical Notes:
- Database uses sql.js (not better-sqlite3) due to platform compatibility
- sql.js requires async initialization → index.js uses async startServer()
- Database auto-saves to disk every 5 seconds and on every write operation
- The getDb() function returns a compatibility wrapper that mimics better-sqlite3 API

### Current Status: 3/265 features passing (1.1%)

### What should be worked on next:
- More infrastructure features (if assigned)
- Authentication features (login UI, JWT sessions, etc.)
- Frontend setup with React + Vite + Tailwind CSS

## Session 2 - 2026-02-07

### Completed Features:
- Feature #5: Backend API queries real database ✅
- Feature #6: App loads without errors in browser ✅
- Feature #7: Login page renders with form fields ✅

### Verification Details:
- Feature #5: Confirmed server logs show [SQL] prefixed queries for every API call
  - Login: SELECT ... FROM users WHERE email = ?
  - Auth/me: SELECT u.id, u.email, ... FROM users u JOIN organizations o ...
  - No mock data patterns found in src/
- Feature #6: Frontend loads at http://localhost:5175 without blank screen
  - Zero JavaScript errors, zero warnings
  - React app renders login page correctly
  - Vite proxy to backend works for /api routes
- Feature #7: Login page renders with all required elements
  - "Tap In" branding heading present
  - "Gestión financiera para tu CPP" subtitle
  - Email input (labeled "Correo electrónico", placeholder "tu@correo.cl")
  - Password input (labeled "Contraseña")
  - "Ingresar" submit button
  - Professional purple gradient styling with white card

### Technical Notes:
- Frontend built with React + Vite + Tailwind CSS v4
- Frontend runs on port 5173 (or next available: 5174, 5175)
- Vite proxies /api requests to backend at localhost:3001
- AuthContext handles JWT storage in localStorage
- ProtectedRoute/PublicRoute handle authentication-based routing
- DM Sans font loaded from Google Fonts
- Custom color theme with primary (purple) and accent (teal) colors defined in index.css @theme

### Starting frontend server:
  npm --prefix /c/Users/josel/CPP/frontend run dev -- --host

### Current Status: 7/265 features passing (2.6%)

### What should be worked on next:
- Authentication flow features (login functionality, session management)
- Dashboard content with real data
- Navigation and routing features
- Payment request workflow

## Session 3 - 2026-02-08

### Completed Features:
- Feature #11: Login fails with invalid credentials ✅
- Feature #12: User can logout successfully ✅
- Feature #14: JWT session persists across page refreshes ✅

### Changes Made:
- Fixed api.js request() to not intercept 401 on /auth/login endpoint
  - Previously, any 401 would trigger token removal + redirect, preventing the
    login error message from reaching the Login component
  - Now /auth/login 401 responses pass through so "Credenciales inválidas" displays

### Verification Details:
- Feature #11: Login with wrong password shows "Credenciales inválidas" error
  - Same error for wrong email AND wrong password (no information leakage)
  - No JWT token stored on failed login
  - User stays on login page
  - Verified via Playwright browser automation
- Feature #12: Logout works end-to-end
  - "Cerrar sesión" button in sidebar triggers logout
  - JWT token cleared from localStorage
  - User redirected to /login
  - Accessing protected routes after logout redirects to /login
  - Verified via Playwright test script
- Feature #14: JWT session persists across page refreshes
  - Token persists in localStorage across F5/reload
  - AuthContext useEffect checks token on mount, calls /auth/me to restore user
  - User info (name, role) displays correctly after refresh
  - No console errors, no redirect to login
  - Even works across multiple refreshes
  - Verified via Playwright test script

### Current Status: 10/265 features passing (3.8%)

### What should be worked on next:
- Dashboard content with real data
- Navigation and routing features
- Payment request workflow
- Category management
